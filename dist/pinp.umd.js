!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("draggabilly")):"function"==typeof define&&define.amd?define(["draggabilly"],e):t.pinp=e(t.draggabilly)}(this,function(t){t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e){null==e&&(e=Object.getPrototypeOf(t));for(var n=0,o=Object.getOwnPropertyNames(e);n<o.length;n+=1){var i=o[n];"function"==typeof e[i]&&(t[i]=e[i].bind(t))}},n=function(n,o){var i=this;void 0===o&&(o={});var r=o.container;void 0===r&&(r=document.documentElement);var a=o.grid;void 0===a&&(a=[1,1]);var s=o.debug;if(void 0===s&&(s=!1),!n)throw new TypeError("Box constructor expects HTMLElement, "+typeof n+" given");this.grid=a,this.debug=s,this.element=n,this.element.style.position="absolute",this.container=r,this.lastMove=Date.now(),this.dragInstance=new t(n,{grid:a,containment:r}),this.dragInstance.on("dragStart",function(){i.isDragging=!0}),this.dragInstance.on("dragMove",function(){i.lastMove=Date.now()}),this.dragInstance.on("dragEnd",function(){i.isDragging=!1}),e(this)};n.prototype.destroy=function(){this.dragInstance.destroy()},n.prototype.collide=function(t){return this.collideOnXAxis(t)&&this.collideOnYAxis(t)},n.prototype.delta=function(t){return[this.center.x-t.center.x,this.center.y-t.center.y]},n.prototype.freeze=function(){this.frozen||(this.frozen=!0,this.frozenBoundingBox=this._computeBoundingBox(),this.debug&&this.element.classList.add("frozen"))},n.prototype.unfreeze=function(){this.frozen=!1,this.debug&&this.element.classList.remove("frozen")},n.prototype.collideOnYAxis=function(t){if(t)return t!==this&&this.xmax>t.xmin&&this.xmin<t.xmax},n.prototype.collideOnXAxis=function(t){if(t)return t!==this&&this.ymax>t.ymin&&this.ymin<t.ymax},n.prototype.move=function(t,e){this.isDragging||(this.dragInstance.setPosition(t,e),this.lastMove=Date.now(),this.update())},n.prototype.update=function(){var t=this;this.boundingBox=this._computeBoundingBox(),Object.keys(this.boundingBox).forEach(function(e){t[e]=t.boundingBox[e]})},n.prototype._computeBoundingBox=function(){var t=this.element.getBoundingClientRect(),e=t.width,n=t.height,o=this.dragInstance.position.x,i=this.dragInstance.position.y;return Object.freeze({x:o,y:i,width:e,height:n,xmin:o,ymin:i,xmax:o+e,ymax:i+n,center:{x:o+e/2,y:i+n/2}})};var o=function(t){void 0===t&&(t={});var n=t.noOOB;void 0===n&&(n=!0);var o=t.debug;void 0===o&&(o=!1);var i=t.maxSolverIterations;void 0===i&&(i=999);var r=t.pushBehavior;void 0===r&&(r="both"),this.boxes=[],this.noOOB=n,this.debug=o,this.maxSolverIterations=i,this.pushBehavior=r,this.update(),e(this)};o.prototype.add=function(t){if(!(t instanceof n))throw new TypeError("Expecting a pinp.Box instance but got "+t);this.boxes.push(t)},o.prototype.remove=function(t){if(!(t instanceof n))throw new TypeError("Expecting a pinp.Box instance but got "+t);var e=this.boxes.indexOf(t);e>-1&&(t.destroy(),this.boxes.splice(e,1))},o.prototype.freeze=function(){this.frozen||(this.frozen=!0,this.boxes.forEach(function(t){return t.freeze()}))},o.prototype.unfreeze=function(){this.frozen&&(this.frozen=!1,this.boxes.forEach(function(t){return t.unfreeze()}))},o.prototype.update=function(){this.frozen||(this._updateBoundingBox(),this.noOOB&&this.ensureInBounds())},o.prototype._updateBoundingBox=function(){var t=this,e=o.computeBoundingBox(this.boxes);Object.entries(e).forEach(function(e){t[e[0]]=e[1]})},o.computeBoundingBox=function(t){var e=0,n=0,o=0,i=0;return t.forEach(function(t){t.boundingBox||t.update(),e=Math.min(e,t.xmin),n=Math.min(n,t.ymin),o=Math.max(o,t.xmax),i=Math.max(i,t.ymax)}),{x:e,y:n,width:o,height:i,xmin:e,xmax:e+o,ymin:n,ymax:n+i}},o.prototype.ensureInBounds=function(){var t=-Math.min(0,this.xmin),e=-Math.min(0,this.ymin);(t||e)&&(this.boxes.forEach(function(n){return n.move(n.x+t,n.y+e)}),this._updateBoundingBox())},o.prototype.pack=function(t){var e=this;void 0===t&&(t={});var n=t.maxSolverIterations;void 0===n&&(n=this.maxSolverIterations);var o=t.debug;void 0===o&&(o=this.debug);var i=t.pushBehavior;void 0===i&&(i=this.pushBehavior),this.boxes=this.boxes.sort(function(t,e){return e.lastMove-t.lastMove}),this.boxes.forEach(function(t,e){t.frozen?t.move(t.frozenBoundingBox.x,t.frozenBoundingBox.y):t.update(),o&&(t.packingOrder=e,t.element.setAttribute("data-packing-order",e))});for(var r=0,a=this.boxes.filter(function(t){return e.boxes.some(t.collide)}),s=function(){var t=a.shift(),n=e.boxes.filter(t.collide);n&&n.length&&n.forEach(function(e){var n=t.delta(e),r="horizontal"===i||"vertical"!==i&&Math.abs(n[0])>=Math.abs(n[1]);o&&console.log({current:t.packingOrder,collide:e.packingOrder,delta:n,direction:r?"horizontal":"vertical"}),r&&n[0]<=0&&e.move(t.xmax,e.y),r&&n[0]>0&&e.move(t.xmin-e.width,e.y),!r&&n[1]<=0&&e.move(e.x,t.ymax),!r&&n[1]>0&&e.move(e.x,t.ymin-e.height),a.push(e)})};a.length&&++r<n;)s();this.update()};var i=function(t){return"object"==typeof window.HTMLElement?t instanceof window.HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName};function r(){}return function(t){void 0===t&&(t={});var e=t.container;void 0===e&&(e=".pinp-container");var a=t.debug;void 0===a&&(a=!1);var s=t.grid;void 0===s&&(s=[50,50]);var d=t.maxSolverIterations;void 0===d&&(d=999);var u=t.noOOB;void 0===u&&(u=!0);var h=t.pushBehavior;void 0===h&&(h="both");var c=t.updateContainerHeight;void 0===c&&(c=!0);var f=t.updateContainerWidth;void 0===f&&(f=!0);var p=t.lastDraggedClassname;void 0===p&&(p="last-dragged");var v=t.willUpdate;void 0===v&&(v=r);var g=t.didUpdate;if(void 0===g&&(g=r),!(e=i(e)?e:document.querySelector(e)))throw new Error("Cannot find container");var x=new o({debug:a,maxSolverIterations:d,noOOB:u,pushBehavior:h});return{add:function(t){var o=new n(t,{container:e,debug:a,grid:s});return o.dragInstance.on("dragStart",function(){!function(t){if(t){for(var n=e.querySelectorAll("."+p),o=0;o<n.length;o++)n[o].classList.remove(p);t.element.classList.add(p)}}(o),x.freeze()}),o.dragInstance.on("dragMove",function(){window.requestAnimationFrame(function(){v(),o.unfreeze(),x.pack({debug:!1}),g()})}),o.dragInstance.on("dragEnd",function(){x.unfreeze(),l()}),x.add(o),o},remove:function(t){i(t)&&(t=x.boxes.find(function(e){return e.element===t})),x.remove(t)},update:l,get boxes(){return x.boxes},get width(){return x.xmax},get height(){return x.ymax}};function l(){window.requestAnimationFrame(function(){v(),x.pack(),f&&(e.style.width=x.xmax+"px"),c&&(e.style.height=x.ymax+"px"),g()})}}});
//# sourceMappingURL=pinp.umd.js.map
