!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("draggabilly")):"function"==typeof define&&define.amd?define(["draggabilly"],n):t.pinp=n(t.draggabilly)}(this,function(t){t=t&&t.hasOwnProperty("default")?t.default:t;var n=function(t,n){void 0===n&&(n={});var e=n.noOOB;void 0===e&&(e=!0);var o=n.debug;void 0===o&&(o=!1);var i=n.maxSolverIterations;void 0===i&&(i=999),this.boxes=t,this.noOOB=e,this.debug=o,this.maxSolverIterations=i,this.update()};function e(){}n.prototype.update=function(){this._updateBoundingBox(),this.noOOB&&this.ensureInBounds()},n.prototype._updateBoundingBox=function(){var t=this,e=n.computeBoundingBox(this.boxes);Object.entries(e).forEach(function(n){t[n[0]]=n[1]})},n.computeBoundingBox=function(t){var n=0,e=0,o=0,i=0;return t.forEach(function(t){t.boundingBox||t.update(),n=Math.min(n,t.xmin),e=Math.min(e,t.ymin),o=Math.max(o,t.xmax),i=Math.max(i,t.ymax)}),{x:n,y:e,width:o,height:i,xmin:n,xmax:n+o,ymin:e,ymax:e+i}},n.prototype.ensureInBounds=function(){var t=-Math.min(0,this.xmin),n=-Math.min(0,this.ymin);(t||n)&&(this.boxes.forEach(function(e){return e.move(e.x+t,e.y+n)}),this._updateBoundingBox())},n.prototype.pack=function(t){var n=this;void 0===t&&(t={});var e=t.maxSolverIterations;void 0===e&&(e=this.maxSolverIterations);var o=t.debug;void 0===o&&(o=this.debug),this.boxes=this.boxes.sort(function(t,n){return n.lastMove-t.lastMove}),this.boxes.forEach(function(t,n){t.update(),o&&(t.packingOrder=n,t.element.setAttribute("data-packing-order",n))});for(var i=this.boxes.filter(function(t){return n.boxes.some(t.collide)}),r=0,a=function(){var t=i.shift(),e=n.boxes.filter(t.collide);e&&e.length&&e.forEach(function(n){var e=t.delta(n),r=Math.abs(e[0])>=Math.abs(e[1]);o&&console.log("pinp.Cluster.pack",{current:t.packingOrder,collide:n.packingOrder,detla:e,direction:r?"horizontal":"vertical"}),r&&e[0]<=0&&n.move(t.xmax,n.y),r&&e[0]>0&&n.move(t.xmin-n.width,n.y),!r&&e[1]<=0&&n.move(n.x,t.ymax),!r&&e[1]>0&&n.move(n.x,t.ymin-n.height),i.push(n)})};i.length&&++r<e;)a();this.update()};var o=function(n,o){var i=this;void 0===o&&(o={});var r=o.container;void 0===r&&(r=document.documentElement);var a=o.grid;void 0===a&&(a=[1,1]);var s=o.onMove;if(void 0===s&&(s=e),!n)throw new TypeError("Box constructor expects HTMLElement, "+typeof n+" given");this.grid=a,this.onMove=s,this.element=n,this.element.style.position="absolute",this.container=r,this.lastMove=Date.now(),this.dragInstance=new t(n,{grid:a,containment:r}),this.dragInstance.on("dragMove",function(){i.lastMove=Date.now()}),this.dragInstance.on("dragEnd",this.onMove),function(t,n){null==n&&(n=Object.getPrototypeOf(t));for(var e=0,o=Object.getOwnPropertyNames(n);e<o.length;e+=1){var i=o[e];"function"==typeof n[i]&&(t[i]=n[i].bind(t))}}(this)};return o.prototype.destroy=function(){this.dragInstance.destroy()},o.prototype.collide=function(t){return this.collideOnXAxis(t)&&this.collideOnYAxis(t)},o.prototype.delta=function(t){return[this.center.x-t.center.x,this.center.y-t.center.y]},o.prototype.collideOnYAxis=function(t){if(t)return t!==this&&this.xmax>t.xmin&&this.xmin<t.xmax},o.prototype.collideOnXAxis=function(t){if(t)return t!==this&&this.ymax>t.ymin&&this.ymin<t.ymax},o.prototype.move=function(t,n){this.isDragged||(this.dragInstance.setPosition(t,n),this.lastMove=Date.now(),this.update())},o.prototype.update=function(){var t=this;this.boundingBox=this._computeBoundingBox(),Object.entries(this.boundingBox).forEach(function(n){t[n[0]]=n[1]})},o.prototype._computeBoundingBox=function(){var t=this.element.getBoundingClientRect(),n=t.width,e=t.height,o=this.dragInstance.position.x,i=this.dragInstance.position.y;return{x:o,y:i,width:n,height:e,xmin:o,ymin:i,xmax:o+n,ymax:i+e,center:{x:o+n/2,y:i+e/2}}},function(t){void 0===t&&(t={});var e=t.boxSelector;void 0===e&&(e=".pinp-box");var i=t.container;void 0===i&&(i=".pinp-container");var r=t.debug;void 0===r&&(r=!1);var a=t.grid;void 0===a&&(a=[50,50]);var s=t.maxSolverIterations;void 0===s&&(s=999);var d=t.noOOB;void 0===d&&(d=!0);var u,c=t.updateContainerWidth;void 0===c&&(c=!0),u=i,i=("object"==typeof window.HTMLElement?u instanceof window.HTMLElement:u&&"object"==typeof u&&null!==u&&1===u.nodeType&&"string"==typeof u.nodeName)?i:document.querySelector(i);for(var h=[],p=i.querySelectorAll(e),v=0;v<p.length;v++)l(p[v]);return{add:l,update:x};function l(t){var n=new o(t,{container:i,onMove:x,grid:a});h.push(n)}function x(){window.requestAnimationFrame(function(){var t=new n(h,{debug:r,maxSolverIterations:s,noOOB:d});t.pack(),c&&(i.style.width=t.width+"px")})}}});
//# sourceMappingURL=pinp.umd.js.map
