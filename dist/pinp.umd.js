!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("draggabilly")):"function"==typeof define&&define.amd?define(["draggabilly"],e):t.pinp=e(t.draggabilly)}(this,function(t){t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e){null==e&&(e=Object.getPrototypeOf(t));for(var n=0,o=Object.getOwnPropertyNames(e);n<o.length;n+=1){var i=o[n];"function"==typeof e[i]&&(t[i]=e[i].bind(t))}},n=function(n,o){var i=this;void 0===o&&(o={});var r=o.container;void 0===r&&(r=document.documentElement);var a=o.grid;void 0===a&&(a=[1,1]);var s=o.debug;void 0===s&&(s=!1);var d=o.draggabillyAdditionalOptions;if(void 0===d&&(d={}),!n)throw new TypeError("pinp.Box constructor expects HTMLElement, "+typeof n+" given");this.grid=a,this.debug=s,this.element=n,this.element.style.position="absolute",this.container=r,this.lastMove=Date.now();var u=Object.assign({},d,{grid:a,containment:r});this.dragInstance=new t(n,u),this.dragInstance.on("dragStart",function(){i.isDragging=!0}),this.dragInstance.on("dragMove",function(){i.lastMove=Date.now()}),this.dragInstance.on("dragEnd",function(){i.isDragging=!1}),e(this)};n.isBox=function(t){return t instanceof n},n.TypeError=function(t){return new TypeError("Expecting a pinp.Box instance but got "+t)},n.prototype.destroy=function(){this.dragInstance.destroy()},n.prototype.collide=function(t){return this.collideOnXAxis(t)&&this.collideOnYAxis(t)},n.prototype.delta=function(t){return[this.center.x-t.center.x,this.center.y-t.center.y]},n.prototype.freeze=function(){this.frozen||(this.frozen=!0,this.frozenBoundingBox=this._computeBoundingBox(),this.debug&&this.element.classList.add("frozen"))},n.prototype.unfreeze=function(){this.frozen=!1,this.debug&&this.element.classList.remove("frozen")},n.prototype.collideOnYAxis=function(t){if(t)return t!==this&&this.xmax>t.xmin&&this.xmin<t.xmax},n.prototype.collideOnXAxis=function(t){if(t)return t!==this&&this.ymax>t.ymin&&this.ymin<t.ymax},n.prototype.move=function(t,e){this.isDragging||(this.dragInstance.setPosition(t,e),this.lastMove=Date.now(),this.update())},n.prototype.update=function(){var t=this;this.boundingBox=this._computeBoundingBox(),Object.keys(this.boundingBox).forEach(function(e){t[e]=t.boundingBox[e]})},n.prototype._computeBoundingBox=function(){var t=this.element.getBoundingClientRect(),e=t.width,n=t.height,o=this.dragInstance.position.x,i=this.dragInstance.position.y;return Object.freeze({x:o,y:i,width:e,height:n,xmin:o,ymin:i,xmax:o+e,ymax:i+n,center:{x:o+e/2,y:i+n/2}})};var o=function(t){void 0===t&&(t={});var n=t.container;void 0===n&&(n=document.documentElement);var o=t.boundaries;void 0===o&&(o={top:"none",left:"none",right:"none",bottom:"none"});var i=t.debug;void 0===i&&(i=!1);var r=t.maxSolverIterations;void 0===r&&(r=999);var a=t.pushDirection;void 0===a&&(a="both"),this.boxes=[],this.debug=i,this.container=n,this.maxSolverIterations=r,this.pushDirection=a,this.boundaries=Object.assign({top:"none",left:"none",right:"none",bottom:"none"},o),Object.values(this.boundaries).filter(function(t){return"hard"===t}).length>2&&console.warn(["A pinp.Cluster has been initialized with more than two 'hard' boundaries","As this may cause some packing issues when running out of space, we recommand setting at least two boundaries as either 'soft' or 'none'."].join("\n")),e(this)};o.prototype.add=function(t){if(!n.isBox(t))throw n.TypeError(t);this.boxes.push(t)},o.prototype.remove=function(t){if(!n.isBox(t))throw n.TypeError(t);var e=this.boxes.indexOf(t);e>-1&&(t.destroy(),this.boxes.splice(e,1))},o.prototype.freeze=function(){this.frozen||(this.frozen=!0,this.boxes.forEach(function(t){return t.freeze()}))},o.prototype.unfreeze=function(){this.frozen&&(this.frozen=!1,this.boxes.forEach(function(t){return t.unfreeze()}))},o.computeBoundingBox=function(t){var e=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.forEach(function(t){t.boundingBox||t.update(),e=Math.min(e,t.xmin),n=Math.min(n,t.ymin),o=Math.max(o,t.xmax),i=Math.max(i,t.ymax)}),{x:e,y:n,width:o,height:i,xmin:e,xmax:e+o,ymin:n,ymax:n+i}},o.prototype.pack=function(t){var e=this;void 0===t&&(t={});var n=t.maxSolverIterations;void 0===n&&(n=this.maxSolverIterations);var o=t.debug;void 0===o&&(o=this.debug);var i=t.pushDirection;void 0===i&&(i=this.pushDirection),this._prepareBoxes({debug:o}),this._getContainerSize();for(var r=0,a=this.boxes.filter(function(t){return e.boxes.some(t.collide)});a.length&&++r<n;){var s=a.shift(),d=this._solveFor(s,{debug:o,pushDirection:i});d&&d.length&&(a=a.concat(d))}this.frozen||this._updateBoundingBox()},o.prototype._prepareBoxes=function(t){void 0===t&&(t={});var e=t.debug;void 0===e&&(e=this.direction),this.boxes.length&&(this.boxes=this.boxes.sort(function(t,e){return e.lastMove-t.lastMove}),this.boxes.forEach(function(t,n){t.frozen?t.move(t.frozenBoundingBox.x,t.frozenBoundingBox.y):t.update(),t.packingOrder=n,e&&t.element.setAttribute("data-packing-order",n)}))},o.prototype._getContainerSize=function(){var t=this.container.getBoundingClientRect(),e=t.height;this.containerWidth=t.width,this.containerHeight=e},o.prototype._solveFor=function(t,e){var n=this;void 0===e&&(e={});var o=e.debug;void 0===o&&(o=this.debug);var i=e.pushDirection;void 0===i&&(i=this.pushDirection);var r=[];return this.boxes.filter(t.collide).forEach(function(e){var a=t.delta(e),s=a[0]<=0,d=a[1]<=0,u="both"===i?Math.abs(a[0])>=Math.abs(a[1])?"horizontal":"vertical":i,h=e.x,c=e.y,f={LEFT:function(){h=t.xmin-e.width,c=e.y},RIGHT:function(){h=t.xmax,c=e.y},UP:function(){h=e.x,c=t.ymin-e.height},DOWN:function(){h=e.x,c=t.ymax},HORIZONTAL:function(){return s?f.RIGHT():f.LEFT()},VERTICAL:function(){return d?f.DOWN():f.UP()}};o&&console.log({current:t.packingOrder,collide:e.packingOrder,delta:a,preferedDirection:u}),"horizontal"===u&&f.HORIZONTAL(),"vertical"===u&&f.VERTICAL(),"hard"===n.boundaries.top&&c<0&&f.HORIZONTAL(),"hard"===n.boundaries.left&&h<0&&f.VERTICAL(),"hard"===n.boundaries.bottom&&c+e.height>n.containerHeight&&f.HORIZONTAL(),"hard"===n.boundaries.right&&h+e.width>n.containerWidth&&f.VERTICAL(),h===e.x&&c===e.y||(e.move(h,c),r.push(e))}),r},o.prototype._updateBoundingBox=function(){var t=this,e=o.computeBoundingBox(this.boxes);Object.entries(e).forEach(function(e){t[e[0]]=e[1]})},o.prototype.move=function(t,e){(t||e)&&(this.boxes.forEach(function(n){return n.move(n.x+t,n.y+e)}),this._updateBoundingBox())};var i=function(t){return"object"==typeof window.HTMLElement?t instanceof window.HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName};function r(){}return function(t,e){void 0===e&&(e={});var a=e.debug;void 0===a&&(a=!1);var s=e.grid;void 0===s&&(s=[0,0]);var d=e.maxSolverIterations;void 0===d&&(d=999);var u=e.boundaries;void 0===u&&(u={top:"none",left:"none",right:"none",bottom:"none"});var h=e.pushDirection;void 0===h&&(h="both");var c=e.lastDraggedClassname;void 0===c&&(c="last-dragged");var f=e.willUpdate;void 0===f&&(f=r);var g=e.didUpdate;if(void 0===g&&(g=r),!(t=i(t)?t:document.querySelector(t)))throw new Error("Cannot find container");var p=new o({container:t,debug:a,maxSolverIterations:d,boundaries:u,pushDirection:h});return{add:function(e,o){void 0===o&&(o={});var i=new n(e,{container:t,debug:a,grid:s,draggabillyAdditionalOptions:o});return i.dragInstance.on("dragStart",function(){!function(e){if(e){for(var n=t.querySelectorAll("."+c),o=0;o<n.length;o++)n[o].classList.remove(c);e.element.classList.add(c)}}(i),p.freeze()}),i.dragInstance.on("dragMove",function(){window.requestAnimationFrame(function(){f(),i.unfreeze(),p.pack({debug:!1}),g()})}),i.dragInstance.on("dragEnd",function(){p.unfreeze(),l()}),p.add(i),i},remove:function(t){i(t)&&(t=p.boxes.find(function(e){return e.element===t})),p.remove(t)},update:l,get boxes(){return p.boxes},get width(){return p.xmax},get height(){return p.ymax}};function l(){window.requestAnimationFrame(function(){f(),p.pack(),p.move("soft"===u.left?-p.x:0,"soft"===u.top?-p.y:0),"soft"!==u.left&&"soft"!==u.right||(t.style.width=p.width+"px"),"soft"!==u.top&&"soft"!==u.bottom||(t.style.height=p.height+"px"),g()})}}});
//# sourceMappingURL=pinp.umd.js.map
